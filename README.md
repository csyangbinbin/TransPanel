#发射机数据协议

## 1. 发射机上传到上位机数据  

### 周期性状态更新报文
> 周期性状态更新报文的发送频率为每秒钟1条，主要报告发射机的相关工作状态，传感器等信息。

|编号	 |名称	|长度(字节)	|索引(基数0)|	备注|
|:-------|:-----|:----------|:---------|:-------|
|1	|报文长度|	|1	|0	|
|2	|报文类型	|1	|1	|固定为0x07
|3	|有效标志位	|2	|2	|具体参见下表
|4	|ICAO编号	|3	|4	
|5	|身份识别号	|6	|7	
|6	|GPS年月日	|3	|13	
|7	|GPS时分秒	|3	|16	
|8	|GPS搜星数量|	1	|19	
|9	|GPS经度纬度高度信息	|10	|20	
|10|	2字节备用	|2	|30	|固定为0x0000
|11|	消息数	|2	32	
|12	|温度数值	|2	34	|
|13|	气压数值	|2	36	
|14	|CRC16	2	|38	

**详细信息:**  

*	有效标志位信息  

MSB      ----------------------------------------------------------->             LSB  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+  
| LMX | TRS| TRT | TRSY | UPEN| UPMD | LOSY | LOSU |TEMP | PRES | 0 | 0 | 0 |0 |0 | 0|  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+

_状态位说明_

|名称	|值为1	|值为0			|
|-------|-------|---------------|
|LMX	|频率源已锁定			|频率源未锁定|
|TRS	|发射已开启			|发射已关闭|
|TRT	|发射测试启动			|发射测试关闭|
|TRSY	|同步发射模式			|正常发射模式|
|UPEN	|接收上传开启			|接收上传关闭|
|UPMD	|接收解码上传			|接收原始上传|
|LOSY	|定位系统正常			|定位系统异常|
|LOSU	|使用外部定位系统		|使用内部定位系统|
|TRMP	|温度传感器正常		|温度传感器异常|
|PRESS	|气压传感器正常		|气压传感器异常|


*	GPS经度纬度高度信息说明

MSB             --------------------------------------------------->		LSB  

|经度符号(1bit)|	纬度符号(1bit)|	高度符号(1bit)|	经度整数(15bit)|	经度小数(14bit)|	纬度整数(15bit)|	纬度小数(14bit)|	高度(16bit)|
|-------|----------|-----------|-----------|-----------|-----------|-----------|--------|



> 说明: 经纬度符号中1表示正数，0表示负数。经纬度为DDMM.SSS表示 ，正数部分为DDMM,小数部分为SS,例如从GPS中 GPRMC报文读取内容为12134.1431,则整数部分为12134 ,小数部分为1431 。


* 温度
`计算公式为 :Temp = (data[34]*256 +data[35])*0.03125 ;`

* 气压数值
`计算公式: Press = ((data[36]*256+data[37])-1638)* 0.0789  ;`


## 2.上位机下传命令数据

*	发射开启/关闭命令<br>
发射关闭: \x14\x6F\x05\x33\x48\x52\x44\x01 ;<br>
发射开启: \x14\x6F\x05\x33\x48\x52\x44\x02 ; <br>

*	发射测试开启关闭<br>
发射测试关闭: \x14\x6F\x05\x33\x48\x52\x44\x0b ;<br>
发射测试开启: \x14\x6F\x05\x33\x48\x52\x44\x0c ;<br>

*	同步/正常发射模式<br>
同步发射模式: \x14\x6F\x05\x33\x48\x52\x44\x04 ;<br>
正常发射模式:\x14\x6F\x05\x33\x48\x52\x44\x03 ;<br>

*	接收上传开启/关闭<br>
接收上传关闭: \x14\x6F\x05\x33\x48\x52\x44\x05 ;<br>
接收上传开启: \x14\x6F\x05\x33\x48\x52\x44\x06 ;<br>

*	解码/原始上传模式<br>
接收解码上传: \x14\x6F\x05\x33\x48\x52\x44\x08 ; <br>
接收原始上传: \x14\x6F\x05\x33\x48\x52\x44\x07 ;<br>

* 使用外部\内部定位源<br>
	使用外部定位源: \x14\x6F\x05\x33\x48\x52\x44\x0A ;<br>
	使用内部定位源: \x14\x6F\x05\x33\x48\x52\x44\x09 ;<br>
* 连接测试命令<br>
连接测试: \x14\x6F\x05\x33\x48\x52\x44\x00 ;


*	保存配置命令

|编号	|内容	|长度	|备注|
|-------|-------|-------|---|
|1	|报文头部	|8字节	|
|2	|ICAO地址	|6字节	|ASCII码表示
|3	|身份识别码	|8字节	|ASCII码表示
|4	|频率源		|1字节	|单位:MHZ
|5	|配置信息比特位	|1字节	

报文头部数据: \x14\x6F\x14\x33\x48\x52\x44\xAA 。  

配置信息比特位详细说明:  
MSB      ------------------------------> LSB  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|0 | 0| TRT | TRS | TRSY | UPEN | UPMD |LOSU|   
+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++

频率源说明:<br>
 频率源的取值范围为[1080  ,1100] , 数据写入报文时减去1080 。




